pipeline{
    agent any //defining agent

    stages{
	
	    stage('app-code'){
            steps{
                
                dir('app-code') {
                     git url: "https://github.com/Aniket-d-d/TWSThreeTierAppChallenge.git", branch: "ak-automate" //clone-the app-code
                }
            }
        }
        
		stage('Build Images'){
            steps{
			
			     dir('app-code/frontend') {
				 sh "docker build -t three-tier-frontend:latest ."
				 echo "Frontend Image Built Successfully"
				}

				 dir('app-code/backend') {
				 sh "docker build -t three-tier-backend:latest ."
				 echo "Backend Image Built Successfully"
				}
            }
            
        }
		
		stage('Push Images'){

		    environment {
                AWS_CREDS = credentials('aws-cli-cred')   //docker-credentials
            }
            steps{
                 dir('app-code'){
				 sh "chmod +x update_variables.sh"
				 sh "./update_variables.sh"
				 }
				 dir('app-code/jenkins-pipelines'){
				 sh "chmod +x push-images-pipeline.sh"
				 sh "./push-images-pipeline.sh"	
                 
			}
        }
        
   	 }
	}
}